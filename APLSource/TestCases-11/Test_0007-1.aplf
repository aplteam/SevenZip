 r←Test_0007(stopFlag batchFlag);zipFilename;filename;myZipper;rc;more;found;⎕TRAP;pattern
 ⍝ Compress a tree into a non-existing file with type "tar"
 r←∆Failed
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')

 zipFilename←∆OutputPath,'zip_007'
 pattern←∆InputPath,'*'

⍝ Delete any left overs
 #.FilesAndDirs.DeleteFile zipFilename,'.tar'

⍝ The test
 myZipper←⎕NEW ##.SevenZip(zipFilename #'tar')
 rc←myZipper.Add pattern
 →GoToTidyUp 0≠3⊃rc

 (rc more)←myZipper.List 0
 →GoToTidyUp~#.FilesAndDirs.Exists zipFilename,'.tar'
 →GoToTidyUp rc≠0
 →GoToTidyUp 9≠⍴more

 (rc more)←myZipper.Unzip ∆TempPath
 →GoToTidyUp rc≠0
 found←⊃('recursive' 1)#.FilesAndDirs.Dir ∆TempPath
 →GoToTidyUp 10≠⍴found
 r←∆OK

∆TidyUp:
 {}#.FilesAndDirs.RmDir ∆TempPath
 #.FilesAndDirs.DeleteFile zipFilename,'.tar'
